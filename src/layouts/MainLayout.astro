---
// MainLayout.astro
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PKC</title>
  
  <!-- Runtime environment variables -->
  <script is:inline>
    // Initialize RUNTIME_ENV as empty object
    window.RUNTIME_ENV = window.RUNTIME_ENV || {};
    
    console.log("Initial environment variables:", window.RUNTIME_ENV);
  </script>
  
  <!-- Load runtime environment variables from API endpoint -->
  <script>
    // Load environment variables from the runtime-env.js endpoint
    // This works in both development and Docker environments
    fetch('/runtime-env.js')
      .then(response => {
        if (response.ok) {
          return response.text();
        }
        throw new Error('Runtime env endpoint not available');
      })
      .then(script => {
        // Execute the script to set window.RUNTIME_ENV
        eval(script);
        console.log("✅ Runtime environment variables loaded from API:", window.RUNTIME_ENV);
        
        // Dispatch a custom event to notify other scripts that env is ready
        window.dispatchEvent(new CustomEvent('runtime-env-loaded', { 
          detail: window.RUNTIME_ENV 
        }));
      })
      .catch(error => {
        console.error('❌ Failed to load runtime environment variables:', error);
        console.log('Current RUNTIME_ENV state:', window.RUNTIME_ENV);
      });
  </script>
  
  <!-- Slot for head content from child layouts -->
  <slot name="head"/>
</head>
<body>
  <slot />
</body>
</html>
